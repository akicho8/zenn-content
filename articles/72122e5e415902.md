---
title: "アップロードした画像の寸法を得る方法"
emoji: "🖼"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["画像", "アップロード", "寸法", "サイズ", "バッドノウハウ"]
published: true
---

# 概略 #

  * Image のインスタンスの src にデータを渡し、読み込まれた段階で寸法がわかる
  * その前の段階の読み込み方法に二通りの選択がある
    1. FileReader (Data URL Scheme)
    1. createObjectURL (Blog URL Scheme)
  * ただ寸法だけ知りたい場合はどちらでもよい
    * createObjectURL の方がややシンプルに書けるなどの利点はある
  * 同時にデータも欲しい場合(通常はこっち)は形式が異なるためどちらでもよくはない
  * 読み込みと寸法を得る処理を一緒に行おうとしているからややこしくなっているとも思える
  * とにかくめんどい

# 方法1. ただ寸法だけ知りたい #

```vue
<template lang="pug">
.App
  input(type="file" @change="change_handle" ref="file_input")
</template>

<script>
export default {
  methods: {
    change_handle() {
      const file = this.$refs["file_input"].files[0]
      const image = new Image()
      image.onload = () => {
        console.log(image.naturalWidth)  // => 800
        console.log(image.naturalHeight) // => 600
        URL.revokeObjectURL(image.src)   // (寸法だけを知りたいので)破棄する
      }
      image.src = URL.createObjectURL(file)
      console.log(image.src)             // => blob:http://localhost:8080/231a3dc4-147d-4298-abad-1d9a5e4f530d
    },
  },
}
</script>
```

  * 常識的に考えて一瞬で取得できてよさそうな情報だけどこんなに書かないといけない
  * input タグを参照した時点でわかるぐらいにはしといて欲しい

# 方法2. Blob URL Scheme にしつつ寸法もりたい #

```vue
<template lang="pug">
.App
  input(type="file" @change="change_handle" ref="file_input")
  img(:src="image_src")
</template>

<script>
export default {
  data() {
    image_src: null,
  },
  methods: {
    change_handle() {
      const file = this.$refs["file_input"].files[0]
      this.image_src = URL.createObjectURL(file)
      console.log(this.image_src) // => blob:http://localhost:8080/231a3dc4-147d-4298-abad-1d9a5e4f530d
      if (true) {
        const image = new Image()
        image.onload = () => {
          console.log(image.naturalWidth)  // => 800
          console.log(image.naturalHeight) // => 600
        }
        image.src = this.image_src
      }
    },
  },
}
</script>
```

  * `createObjectURL` で読んでいるので Blob URL Scheme になっている
  * Blob URL Scheme 形式を img タグの src に渡して表示できる
  * しかしサーバー側に渡してサーバーから読み込むことはできない(はず)

# 方法3. Data URL Scheme にしつつ寸法を知りたい #

```vue
<template lang="pug">
.App
  input(type="file" @change="change_handle" ref="file_input")
  img(:src="image_src")
</template>

<script>
export default {
  data() {
    image_src: null,
  },
  methods: {
    change_handle() {
      const file = this.$refs["file_input"].files[0]

      const reader = new FileReader()
      reader.addEventListener("load", () => { // load: 成功したときのイベント
        console.log(reader.result)            // => data:image/jpeg;base64,/9j/4AAQSkZJ...
        this.image_src = reader.result
        if (true) {
          const image = new Image()
          image.onload = () => {
            console.log(image.naturalWidth)   // => 800
            console.log(image.naturalHeight)  // => 600
          }
          image.src = this.image_src
        }
      }, false)
      reader.readAsDataURL(file)
    },
  },
}
</script>
```

  * FileReader で読んでいるので Data URL Scheme になっている

# 参考 🙏 #

https://gotohayato.com/content/519/
https://qiita.com/zenpou/items/4b1a0946b120fecd4494
