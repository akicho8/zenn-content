---
title: "Emacsã§AtCoderç’°å¢ƒã‚’æ•´ãˆãŸ"
emoji: "ğŸ¥‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Emacs", "AtCoder", "ç«¶ãƒ—ãƒ­", "Ruby", "Rust"]
published: true
---

## ã¯ã˜ã‚ã«

Emacs + Ruby ã§ç«¶ãƒ—ãƒ­ã‚’ã‚„ã‚‹ã¨ã„ã†æ™‚ç‚¹ã§ã»ã¼éœ€è¦ã¯ãªã„ã¨æ€ã„ã¾ã™ãŒå‚™å¿˜éŒ²ã‚’å…¼ã­ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

å€‹ã€…ã®ã‚³ãƒãƒ³ãƒ‰ã®æ„å‘³ã¯ã‚°ã‚°ã‚‹ã¨ãŸãã•ã‚“å‡ºã¦ãã‚‹ã®ã§ã“ã¡ã‚‰ã¯ã‚·ã‚§ãƒ«ã«æµã›ã°æ¸ˆã‚€ã‚ˆã†ãªç°¡æ½”ã•ã‚’æ„è­˜ã—ã¦æ›¸ã„ã¦ã„ã¾ã™ã€‚

ã®ã¡ã®ã¡ Rust ã§ã‚‚è§£ããŸã„ã®ã§ãŠã¾ã‘ã§ Rust ç”¨ã®ç’°å¢ƒã‚‚ä½œã£ã¦ã„ã¾ã™ã€‚

## Ruby ç”¨

atcoder-cli ã®å°å…¥ãƒ»ãƒ†ã‚¹ãƒˆãƒ»æå‡ºã®æ‰‹é †

```sh
pip3 install online-judge-tools
yarn global add atcoder-cli
acc check-oj
acc login
acc session
acc config default-test-dirname-format test
acc config default-task-choice all
acc config default-template ruby

cd ~/Library/Preferences/atcoder-cli-nodejs
mkdir ruby
cd ruby
emacsclient template.json
emacsclient main.rb

mkdir -p ~/src/procon/ruby
cd ~/src/procon/ruby
acc new math-and-algorithm
cd math-and-algorithm/001
echo "p gets.to_i + 5" > main.rb
oj t -c "ruby main.rb"
acc s main.rb -- -w 0 -y
```

```json:template.json
{
  "task":{
    "program": ["main.rb"],
    "submit": "main.rb"
  }
}
```

```ruby:main.rb
$stdin = DATA
n = gets.to_i
p gets.split.take(n).collect(&:to_i)
__END__
3
10 20 30
```

- atcoder-cli ã®å®Ÿéš›ã®ã‚³ãƒãƒ³ãƒ‰åãŒ acc
  - acc ã¯ AtCoder Command line interface ã®ç•¥ã¨æ€ã‚ã‚Œã‚‹
- atcoder-cli ã¯ Ruby ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„
  - Python C C++ ã‚‚ã„ã‘ã‚‹
  - Rust ã‚‚ã„ã‘ã‚‹ã‘ã©ã€å¤–éƒ¨ã‚¯ãƒ¬ãƒ¼ãƒˆã«ä¾å­˜ã›ãš rustc ã ã‘ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰ã«é™ã‚‹
    - cargo ã‚’ä½¿ã‚ãšã«å¤–éƒ¨ã‚¯ãƒ¬ãƒ¼ãƒˆã¨åˆã‚ã›ã¦ãƒ“ãƒ«ãƒ‰ã§ããªã„ã®ã‹ãªï¼Ÿ
- `acc config default-test-dirname-format test` ãŒè¶…é‡è¦
  - ã“ã‚Œã‚’ã‚„ã£ã¦ãŠã‹ãªã„ã¨ `oj t -c "ruby main.rb"` ãŒå‹•ã‹ãªãã¦ã¯ã¾ã‚‹ã€ã¨ã„ã†ã‹ã¯ã¾ã£ãŸ
  - `oj t -c "ruby main.rb" -d tests` ã¨ã™ã‚Œã°å‹•ãã“ã¨ãŒã‚ã¨ã§ã‚ã‹ã£ãŸãŒã€ã¨ã«ã‹ãã™ã’ãƒ¼ã¯ã¾ã£ãŸ
  - ãªã®ã§æœ€åˆã‹ã‚‰ `test` ã§ä½œã‚‹ã‚ˆã†ã«ã—ã¦ãŠã‘ã° `-d tests` ãŒä¸è¦ã«ãªã‚Šã€ã²ã£ã‹ã‹ã‚‹ã“ã¨ã¯ãªããªã‚‹
  - ã“ã‚Œã¯ atcoder-cli ã®ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã®ã“ã ã‚ã‚ŠãŒå½±éŸ¿ã—ã¦ã„ã‚‹
- template.json ã®ãªã‹ã« main.rb ã‚’æå‡ºã™ã‚‹ã¨æ›¸ã„ã¦ã‚ã‚‹ã®ã« `acc s -- -w 0 -y` ã¨ã¯æ›¸ã‘ãªã„ã®ã¯è¬
  - ãªã®ã§ template.json ã® submit ã®æŒ‡å®šã¯æ„å‘³ãªã„

## Rust ç”¨

cargo-compete ã®å°å…¥ãƒ»ãƒ†ã‚¹ãƒˆãƒ»æå‡ºã®æ‰‹é †

```sh
mkdir -p ~/src/procon/rust
cd ~/src/procon/rust

cargo install cargo-compete
cargo compete init atcoder
cargo compete login atcoder
rustup install 1.42.0

cargo compete new math-and-algorithm
cd math-and-algorithm/bin
cargo compete open --bin 001
cat <<'EOF' > 001.rs
use proconio::input;
fn main() {
    input! { n: isize, }
    println!("{}", n + 5);
}
EOF
cargo compete test 001
cargo compete submit --no-test --no-watch 001
```

- cargo-atcoder ãŒä»¥å‰ã¯ä¸»æµã ã£ãŸã‚ˆã†ã ãŒã€åŸºæœ¬çš„ãªéƒ¨åˆ†ãŒå¼•ãç¶™ãŒã‚Œã€å°å…¥ã®ã—ã‚„ã™ã•ã‚„ä½¿ã„å‹æ‰‹ãŒ `cargo-compete` ã®æ–¹ãŒã•ã‚‰ã«ã‚ˆããªã£ã¦ã„ã‚‹
- ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ `math-and-algorithm` ã§ `cargo compete open` ã™ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã§ 104 å€‹ã®ã‚¿ãƒ–ãŒé–‹ã‹ã‚Œã‚‹ã®ã§æ³¨æ„
  - ãŸã¶ã‚“5å•ãã‚‰ã„ã®ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã—ã‹æƒ³å®šã—ã¦ãªã„ã‚“ã ã¨æ€ã†
  - `--bin 001` ã¨ã™ã‚Œã°å•é¡Œ 001 ã ã‘é–‹ã‘ã‚‹
- eshell ã§ `cargo compete submit` ã™ã‚‹ã¨è¡¨ãŒã‚ã¡ã‚ƒãã¡ã‚ƒã«ãªã‚‹ã®ã§ `--no-watch` ã—ã¦ã„ã‚‹
- atcoder-cli ã¨ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãŒå¤§ããç•°ãªã‚‹
  - ã©ã†ã—ã¦ã‚‚ä¾å­˜ crate ã‚’ cargo ã§ç®¡ç†ã—ãªã„ã¨ã„ã‘ãªã„ã®ã§æ§‹æˆã‚‚ cargo ä¾å­˜ã«ãªã£ã¦ã„ã‚‹
  - acc ã§ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåãŒå•é¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åã«ãªã£ã¦ã„ãŸãŒã€ã“ã¡ã‚‰ã¯ãƒ•ã‚¡ã‚¤ãƒ«åãŒå•é¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åã«ãªã£ã¦ã„ã‚‹

## Emacs ã®è¨­å®š

CLIã§ä½•ã§ã‚‚ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã¨ã¯ã„ãˆã€ãã‚“ãªã‚³ãƒãƒ³ãƒ‰ã¯åŠæ—¥ã§å¿˜ã‚Œã‚‹ã®ã§ã€æ¬¡ã®ã‚ˆã†ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å‡ºã—ã¦1æ–‡å­—æ‰“ã¦ã°å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

![](/images/72d8bf71da39cb/emacs_ss.png)

ã“ã‚Œã‚’è¡Œã†ã«ã¯ magit ã§æ´»ç”¨ã•ã‚Œã¦ã„ã‚‹ `transient.el` ãŒã´ã£ãŸã‚Šã§ã™ã€‚

```elisp:ç°¡å˜ãªä½¿ã„æ–¹
(transient-define-prefix my-procon-launcher ()
  [
    ("a" "èª¬æ˜1" (lambda () (interactive) (message "A")))
    ("b" "èª¬æ˜2" (lambda () (interactive) (message "B")))
  ]
 )
```

- `a` ã‚’æŠ¼ã™ã¨ "A" ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
- `b` ã‚’æŠ¼ã™ã¨ "B" ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã‚’ã©ã‚“ã©ã‚“æ‹¡å¼µã—ã¦åŠè‡ªå‹•åŒ–ã—ãŸã„ã“ã¨ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

```elisp:my-procon.el
(require 'transient)
(require 'f)

(defun my-procon-eshell-send (command)
  "eshellã‚’ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦æŒ‡å®šã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ"
  (interactive)
  (let ((dir default-directory))
    (eshell)
    (goto-char (point-max))
    (eshell-bol)
    (unless (eobp)
      (kill-line))
    (insert (format "pushd '%s'" dir))
    (eshell-send-input)
    (insert command)
    (eshell-send-input)))

(transient-define-prefix my-procon-launcher ()
  "ç«¶ãƒ—ãƒ­ç”¨ãƒ©ãƒ³ãƒãƒ£ãƒ¼"
  ["Ruby"
   ("i" "å•é¡Œæƒ…å ±å…¥åŠ›"
    (lambda ()
      (interactive)
      (beginning-of-buffer)
      (insert (shell-command-to-string (format "ruby -e \"
require 'pathname'
require 'json'
file = Pathname('../contest.acc.json')
info = JSON.parse(file.read, symbolize_names: true)[:tasks].find { |e| e[:label].casecmp?(ARGV[0]) }
puts '# [' + info[:label] + '] ' + info[:title]
puts '# ' + info[:url]
\" %s" (f-filename (f-dirname (buffer-file-name))))))))
   ("o" "å•é¡ŒURLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã"
    (lambda ()
      (interactive)
      (beginning-of-buffer)
      (shell-command (format "ruby -e \"
require 'pathname'
require 'json'
file = Pathname('../contest.acc.json')
info = JSON.parse(file.read, symbolize_names: true)[:tasks].find { |e| e[:label].casecmp?(ARGV[0]) }
system 'open ' + info[:url]
\" %s" (f-filename (f-dirname (buffer-file-name)))))))
   ("1" "å˜ä½“å®Ÿè¡Œ"
    (lambda ()
      (interactive)
      (set (make-local-variable 'compile-command) "ruby main.rb")
      (call-interactively 'compile)))
   ("t" "ãƒ†ã‚¹ãƒˆ"
    (lambda ()
      (interactive)
      (set (make-local-variable 'compile-command) "oj t -c 'ruby main.rb'")
      (call-interactively 'compile)))
   ("s" "æå‡º"
    (lambda ()
      (interactive)
      (my-procon-eshell-send "acc s main.rb -- -w 0 -y")))
   ("l" "å•é¡Œä¸€è¦§ã®ç¢ºèª"
    (lambda ()
      (interactive)
      (my-procon-eshell-send "acc tasks")))
   ("c" "ã‚³ãƒ³ãƒ†ã‚¹ãƒˆåã®ç¢ºèª"
    (lambda ()
      (interactive)
      (my-procon-eshell-send "acc contest")))
   ("n" "æ¬¡ã®å•é¡Œã‚’å–å¾—"
    (lambda ()
      (interactive)
      (my-procon-eshell-send "acc add -c next")))
   ("e" "ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†"
    (lambda ()
      (interactive)
      (find-file "~/Library/Preferences/atcoder-cli-nodejs/ruby/main.rb")))
   ("z" "è¨­å®š"
    (lambda ()
      (interactive)
      (dired "~/Library/Preferences/atcoder-cli-nodejs")))
   ]
  ["Rust"
   ("rt" "ãƒ†ã‚¹ãƒˆ (cargo compete test)"
    (lambda ()
      (interactive)
      (set (make-local-variable 'compile-command) (format "cargo compete t %s" (f-base (buffer-file-name))))
      (call-interactively 'compile)))
   ("rs" "æå‡º (cargo compete submit)"
    (lambda ()
      (interactive)
      (my-procon-eshell-send (format "cargo compete s --no-test --no-watch %s" (f-base (buffer-file-name))))))
   ]
  )

;; (my-procon-launcher)
;; (global-set-key (kbd "C-j p") 'my-procon-launcher)
```

- èª¬æ˜æ–‡ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯ã«ã™ã‚‹ã“ã¨
  - åŒã˜ã ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã¨è¦‹ãªã•ã‚Œã¦ã—ã¾ã†

## ãŠã‚ã‚Š

è‡ªåˆ†ã®å ´åˆã¯æ¬¡ã®æ‰‹é †ã§é€²ã‚ã¦ã„ãã“ã¨ãŒå¤šã„ã§ã™ã€‚

1. `i` â†’ å•é¡Œæƒ…å ±å…¥åŠ›
1. `o` â†’ å•é¡ŒURLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
1. `1` â†’ å˜ä½“å®Ÿè¡Œ
1. `t` â†’ ãƒ†ã‚¹ãƒˆ
1. `s` â†’ æå‡º
1. `n` â†’ æ¬¡ã®å•é¡Œã‚’å–å¾—

CLIã§åŠè‡ªå‹•åŒ–ã—ãŸæ“ä½œã‚’ Emacs ã§ã•ã‚‰ã«ç°¡å˜ã«ã™ã‚‹ã¾ã§ã®ç´¹ä»‹ã§ã—ãŸã€‚

## å‚ç…§

http://tatamo.81.la/blog/2018/12/07/atcoder-cli/
https://github.com/online-judge-tools/oj
https://github.com/qryxip/cargo-compete
https://github.com/magit/transient
