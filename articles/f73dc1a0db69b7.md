---
title: "Capybara の知見まとめ"
emoji: "🐙"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Capybara", "Ruby", "自動化"]
published: false
---

## chromedriver がないと言われる

```
Failure/Error: raise Error::WebDriverError, self.class.missing_text unless path

Selenium::WebDriver::Error::WebDriverError:
  Unable to find chromedriver. Please download the server from
  https://chromedriver.storage.googleapis.com/index.html and place it somewhere on your PATH.
  More info at https://github.com/SeleniumHQ/selenium/wiki/ChromeDriver.
```

- エラーメッセージ通りに指定のURLから chromedriver をダウンロードして PATH を設定する、などしてはいけない
- webdrivers gem を入れる

## chromedriver はローカルのどこにある？

```shell
$ exa -al --no-user ~/.webdrivers
.rwxr-xr-x 17M 10 7  2021 chromedriver
.rw-r--r--  13 16 5 06:23 chromedriver.version
```

## chromedriver があるのに正しく動作しない

- Google Chrome と chromedriver のバージョンが一致していないのかもしれない
  - Google Chrome のバージョンは `chrome://settings/help` でわかる
  - chromedriver のバージョンは `cat ~/.webdrivers/chromedriver.version` でわかる
- Google Chrome のバージョンが70以上であれば Google Chrome と chromedriver のバージョンは一致する、と webdrivers gem の README に書いてある
  - しかし Google Chrome が自動アップデートされた直後に同じバージョンの chromedriver がまだ用意されてないことがあった
  - それで一回事故って大変な目にあったことがあるのでバージョン一致説には疑念を持っている
  - なので自分のところでは Google Chrome のバージョンを無理やり固定している
- 絶対に事故らない何か良い方法はないんだろうか？(誰かおせーて)

## グローバルに chromedriver がある

```shell
$ which chromedriver
/usr/local/var/rbenv/shims/chromedriver
```

- それは chromedriver-helper gem の残骸
- 他にも chromedriver で始まる外部コマンドがあるはず
- 全部抹殺しよう

```shell
$ rm /usr/local/var/rbenv/shims/chromedriver*
```

## また chromedriver が出てきた

```shell
$ which chromedriver
/usr/local/bin/chromedriver
```

- それは `brew install chromedriver` で入れたやつ
- 抹殺しよう

```shell
$ brew uninstall chromedriver
```


