---
title: "Panolens の使い方メモ"
emoji: "🖼"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Panolens", "画像", "VR"]
published: false
---

# PANOLENS.Viewer のオプション #

https://pchen66.github.io/panolens.js/docs/Viewer.html

| Key                | Value         | 意味                                                        |
|--------------------|---------------|-------------------------------------------------------------|
| container          | document.body | 描画する場所                                                |
| controlBar         | true          | 左下コントローラーを表示するか？                            |
| controlButtons     | []            | 左下コントローラーの項目 ['fullscreen', 'setting', 'video'] |
| autoHideControlBar | true          | 左下コントロールバー自動非表示にする (どのタイミングで？)   |
| autoHideInfospot   | true          | Infospotsを自動非表示にします                               |
| horizontalView     | true          | 水平カメラ制御のみ許可にする (上下の角度を変えられない)     |
| cameraFov          | 100           | Field Of View (=視野) 0:狭い 100:広い                       |
| reverseDragging    | true          | 操作に対してのカメラ移動を逆にする                          |
| viewIndicator      | false         | 左上に計器を追加 (?)                                        |
| indicatorSize      | 30            | 左上の計器サイズ                                            |
| output             | "console"     | Infospotの位置を console に表示                             |

##### スマホVR向けの照準 #####

| Key               | Value | 意味                                                         |
|-------------------|-------|--------------------------------------------------------------|
| enableReticle     | true  | 画面中央に白点を配置する(大きさでカメラとの距離が把握できる) |
| dwellTime         | 1500  | その白点に指定msヒットしたら 1500 = 1.5秒                    |
| autoReticleSelect | true  | 自動で選択する                                               |

# ファイロセンサー対応 #

```javascript
viewer.toggleNextControl()
```

# output オプションに翻弄された件 #

  * `output: "console"` にしておくとコントロールキーを押している間だけコンソールに位置を表示してくれる
  * 要はそれを見て Infospot を登録するときに使ってね、という意図で作者が入れてくれているんだと思われる
  * それで済む人にとっては、わりと有用だと思う
  * しかし、利用者がというか私が本当に望んでいる機能は、クリックしたワールド座標を**イベント**で返してくれる機能だった
  * なんとかなんないのかと GitHub のコードを見てみると `output: "event"` にすると `position-output` イベントをで座標を送ってくれる機能があった (公開されてるマニュアルには載ってない)
  * これが欲しかったんだという思いで使ってみたらマウスを動かすたびに発生するイベントだった

# クリックした座標を求める #

ありがたいことに組み込みの世界と違ってWEBの世界は自分が困っていることは他の人も困っているので、とくに枯れたライブラリの場合、だいたいググれば解決策が出てくる
そこで見つけたこちらの Issue によると

https://github.com/pchen66/panolens.js/issues/160

自力で書けということだった

https://github.com/pchen66/panolens.js/blob/c90ffbc3f989b60196adc02f4ecf420e54f87528/src/viewer/Viewer.js#L1298

最新バージョンの `output: "console"` のロジックを元にするとこれで良いみたい

```javascript
import * as THREE from "three"

panorama.addEventListener("click", e => {
  const intersects = viewer.raycaster.intersectObject(viewer.panorama, true)
  if (intersects.length > 0) {
    const point = intersects[0].point.clone() // => Vector3 {x: 2572.0764633107765, y: 1892.102225883789, z: -3839.4888925916653}
    const converter = new THREE.Vector3(-1, 1, 1)
    const world = viewer.panorama.getWorldPosition(new THREE.Vector3())
    point.sub(world).multiply(converter)
    console.log(point)                        // => Vector3 {x: -2572.0764633107765, y: 1892.102225883789, z: -3839.4888925916653}
  }
})
```

# 参照 #

https://github.com/pchen66/panolens.js
https://pchen66.github.io/panolens.js/docs/
https://studio-amelie.com/development/panolens-onclick-add-infospot
