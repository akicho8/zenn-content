---
title: "Ruby ã® Pathname ã¿ãŸã„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒ Rust ã«ã‚‚ã‚ã£ãŸ"
emoji: "ğŸ„"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Rust", "Path", "PathBuf", "Pathname"]
published: true
---

å¼•æ•°ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ¸¡ã™ã®ã§ã¯ãªããƒ•ã‚¡ã‚¤ãƒ«åã‚’ãƒ¬ã‚·ãƒ¼ãƒã¨ã—ã¦å„ç¨®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã¶ Ruby ã® Pathname ã®ã‚ˆã†ãªè¶…ä¾¿åˆ©ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ Rust ã«ã¯ãªã„ã ã‚ã†ãªã¨æ€ã£ã¦ãŸã‚‰æ™®é€šã«ã‚ã£ãŸã‚ˆï¼(å¬‰)

## å˜ã«æ–‡å­—åˆ—ã¨ã—ã¦æ§‹é€ ã‚’ç¢ºèªã™ã‚‹ç³»

```rust
Path::new("/aa/bb/cc.tar.gz").is_absolute() // => true
Path::new("cc.tar.gz").is_relative()        // => true
Path::new("/aa/bb/cc.tar.gz").has_root()    // => true
```

```rust
Path::new("/aa/bb/cc.tar.gz").starts_with("/aa/bb")  // => true
Path::new("/aa/bb/cc.tar.gz").ends_with("cc.tar.gz") // => true
```

æ–‡å­—åˆ—ã¨ã¯ã„ãˆãƒ‘ãƒ¼ãƒ„ã®å¢ƒç•Œã‚’ç„¡è¦–ã—ã¦ã¯ã„ã‘ãªã„ã€‚
`starts_with("/a")` ã‚„ `ends_with("gz")` ãªã©ã¯ false ã«ãªã‚‹ã€‚

## å„ãƒ‘ãƒ¼ãƒ„ã‚’å–å¾—ã™ã‚‹ç³»
```rust
Path::new("/aa/bb/cc.tar.gz").extension()   // => Some("gz")
Path::new("/aa/bb/cc.tar.gz").file_name()   // => Some("cc.tar.gz")
Path::new("/aa/bb/cc.tar.gz").file_stem()   // => Some("cc.tar")
Path::new("/aa/bb/cc.tar.gz").file_prefix() // => Some("cc")
Path::new("/aa/bb/cc.tar.gz").parent()      // => Some("/aa/bb")
```

stem ã¯ã€Œå¹¹ã€ã¨ã„ã†æ„å‘³ã‚‰ã—ã„ã€‚
æ‹¡å¼µå­ã‚’çœã„ãŸãƒ•ã‚¡ã‚¤ãƒ«åã®å–å¾—æ–¹æ³•ãŒæ˜ç¢ºãªã®ãŒã‚ã‚ŠãŒãŸã„ã€‚
Ruby ã§ã¯ã‚ˆãä½¿ã†ã®ã« `basename(".*")` ã®ã‚ˆã†ã«æ›¸ã‹ãªã„ã¨ã„ã‘ãªãã¦ç¾ã—ããªã‹ã£ãŸã€‚

## å…¨ãƒ‘ãƒ¼ãƒ„ã‚’é †ã«å–å¾—ã™ã‚‹ç³»
```rust
Path::new("/aa/bb/cc.tar.gz").ancestors().collect::<Vec<_>>()  // => ["/aa/bb/cc.tar.gz", "/aa/bb", "/aa", "/"]
Path::new("/aa/bb/cc.tar.gz").components().collect::<Vec<_>>() // => [RootDir, Normal("aa"), Normal("bb"), Normal("cc.tar.gz")]
Path::new("/aa/bb/cc.tar.gz").iter().collect::<Vec<_>>()       // => ["/", "aa", "bb", "cc.tar.gz"]
```

components ã¯ãªã‚“ã‹ãŠãŠã”ã¨ã«ãªã£ã¦ã„ã‚‹æ„ŸãŒã‚ã‚‹ã‘ã© Rust ã§ã¯ enum ã§åˆ—æŒ™ã—ãŸå®šç¾©ã§ãã®ã¾ã¾ãƒ©ãƒƒãƒ—ã§ãã‚‹ã®ã§æ°—è»½ã«ã“ã†ã„ã†ã“ã¨ã‚’ã‚„ã£ã¦ã—ã¾ã†å‚¾å‘ãŒã‚ã‚‹ã€‚

## ãƒ‘ã‚¹ä½œæˆãƒ»èª¿æ•´ç³»
```rust
// ãƒ‘ã‚¹ã‚’è¿½åŠ ã—ã¦ã„ã(ã‚ˆãä½¿ã†)
Path::new("/aa").join("bb").join("cc.tar.gz")         // => "/aa/bb/cc.tar.gz"

// ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»æ‹¡å¼µå­ã®ç½®ãæ›ãˆ
Path::new("/aa/bb/cc.tar.gz").with_file_name("xxx")   // => "/aa/bb/xxx"
Path::new("/aa/bb/cc.tar.gz").with_extension("xxx")   // => "/aa/bb/cc.tar.xxx"

// ç¥–å…ˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé™¤å»
Path::new("/aa/bb/cc.tar.gz").strip_prefix("/aa/bb")  // => Ok("cc.tar.gz")
```

æ–°ã—ã„ Path å‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã—ã¦ãã‚Œã‚‹ã®ã§ä½¿ã„ã‚„ã™ã„ã€‚

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«å°‘ã—ã‚¢ã‚¯ã‚»ã‚¹ã—ã¡ã‚ƒã†ç³»
```rust
Path::new("/bin").exists()      // => true
Path::new("/bin").try_exists()  // => Ok(true)
Path::new("/bin/cat").is_file() // => true
Path::new("/bin").is_dir()      // => true
Path::new("/etc").is_symlink()  // => true
```

ãƒ¡ã‚½ãƒƒãƒ‰åãŒã‚ã‹ã‚Šã‚„ã™ã„ã€‚

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ãŒã£ã¤ã‚Šã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‹ã‚ˆã†ãªæ°—ãŒã™ã‚‹ç³»
```rust
Path::new("/etc").metadata()         // => Ok(Metadata { file_type: FileType(FileType { mode: 16877 }), is_dir: true, is_file: false, permissions: Permissions(FilePermissions { mode: 16877 }), modified: Ok(SystemTime { tv_sec: 1646948709, tv_nsec: 53641797 }), accessed: Ok(SystemTime { tv_sec: 1646964920, tv_nsec: 777256864 }), created: Ok(SystemTime { tv_sec: 1577865600, tv_nsec: 0 }), .. })
Path::new("/etc").symlink_metadata() // => Ok(Metadata { file_type: FileType(FileType { mode: 41453 }), is_dir: false, is_file: false, permissions: Permissions(FilePermissions { mode: 41453 }), modified: Ok(SystemTime { tv_sec: 1577865600, tv_nsec: 0 }), accessed: Ok(SystemTime { tv_sec: 1577865600, tv_nsec: 0 }), created: Ok(SystemTime { tv_sec: 1577865600, tv_nsec: 0 }), .. })
Path::new("/etc").read_link()        // => Ok("private/etc")
Path::new("/etc").read_dir().unwrap().take(2).collect::<Vec<_>>() // => [Ok(DirEntry("/etc/kcpassword")), Ok(DirEntry("/etc/hosts~"))]
```

è‚å¿ƒã® `glob` ã¯ãªã„ã‚“ã‹ã„(å°å£°)

ç¶šãã¯ã“ã¡ã‚‰â†“

https://zenn.dev/megeton/articles/5e16c6a0b395a4

## æ­£è¦åŒ–
```rust
// . ã‚’å«ã‚€ãƒ‘ã‚¹ã‚’æ­£è¦åŒ–ã™ã‚‹
Path::new("/usr/bin/..").canonicalize()    // => Ok("/usr")
Path::new("../../../../..").canonicalize() // => Ok("/Users")
```

æ–‡å­—åˆ—æ“ä½œã ã‘ã§ãªããƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹é€ ã‚‚å®Ÿéš›ã«è¦‹ã¦ã„ã‚‹ã€‚
`~/` ã¯å±•é–‹ã—ã¦ãã‚Œãªã‹ã£ãŸã€‚

## å‹å¤‰æ›
```rust
// è¡¨ç¤ºã™ã‚‹ç”¨ã®æ–‡å­—åˆ— (ãƒ¡ã‚½ãƒƒãƒ‰åã«ã‹ãªã‚Šé•å’Œæ„Ÿã¯ã‚ã‚‹)
Path::new("/aa/bb/cc.tar.gz").display()         // => "/aa/bb/cc.tar.gz"

// OsStr å‹ã«ã™ã‚‹ (ã™ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ)
let s = Path::new("/aa/bb/cc.tar.gz").as_os_str()
s                                               // => "/aa/bb/cc.tar.gz"
std::any::type_name_of_val(s)                   // => "std::ffi::os_str::OsStr"

// ä¸æ­£ãªæ–‡å­—ãŒã‚ã‚‹ã¨å¤±æ•—ã™ã‚‹ç‰ˆ
Path::new("/aa/bb/cc.tar.gz").to_str()          // => Some("/aa/bb/cc.tar.gz")

// ä¸æ­£ãªæ–‡å­—ã¯ç„¡è¦–ã—ã¦å¼·è¡Œã™ã‚‹ç‰ˆ
Path::new("/aa/bb/cc.tar.gz").to_string_lossy() // => "/aa/bb/cc.tar.gz"

// PathBuf å‹ã«ã™ã‚‹
let path = Path::new("/aa/bb/cc.tar.gz").to_path_buf();
std::any::type_name_of_val(&path)               // => "std::path::PathBuf"
```

## PathBuf å‹ã«ã™ã‚‹ã¨è‡ªåˆ†ã‚’æ›´æ–°ã§ãã‚‹
```rust
let mut path = PathBuf::new();
path.push("/");
path.push("aa");
path.push("xx");
path // => "/aa/xx"
path.pop();
path // => "/aa"
path.push("bb");
path // => "/aa/bb"
path.push("xxx.txt");
path // => "/aa/bb/xxx.txt"

// set_file_name ã¯ã„ã£ãŸã‚“ pop ã—ã¦ push ã™ã‚‹ã®ã¨åŒç­‰ã£ã½ã„
path.set_file_name("cc.tar.xx");
path // => "/aa/bb/cc.tar.xx"

path.set_extension("gz");

// å®Œæˆ
path // => "/aa/bb/cc.tar.gz"
```

```rust
// æ›´æ–°ãŒçµ‚ã‚ã£ãŸã‚‰ Path å‹ã«æˆ»ã—ã¦ãŠã“ã†
let path = path.as_path();
std::any::type_name_of_val(path) // => "std::path::Path"
```

Path å‹ã ã‘ã§æŸ”è»Ÿãªæ“ä½œãŒã§ãã‚‹ã®ã§ PathBuf ã¯ã‚ã¾ã‚Šä½¿ã‚ãªãã†ã€‚

## `~/` ã‚’å±•é–‹ã—ã¦ãã‚Œã‚‹ã‚„ã¤ã¯ãªã„ï¼Ÿ

```ruby:Ruby
Pathname("~/").expand_path # => "/Users/alice"
```

ã“ã‚Œã‚’ã‚„ã‚ŠãŸã„ã‘ã©å¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã€‚
ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ä¾å­˜ã™ã‚‹ã®ã§æ¨™æº–ã§ã¯ç”¨æ„ã—ã¦ãªã„ã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚

ç¶šãã¯ã“ã¡ã‚‰â†“

https://zenn.dev/megeton/articles/f9ef31fbbbada3
